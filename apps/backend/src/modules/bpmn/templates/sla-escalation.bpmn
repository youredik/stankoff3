<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:zeebe="http://camunda.org/schema/zeebe/1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="Definitions_SlaEscalation" targetNamespace="http://bpmn.io/schema/bpmn">
  <bpmn:process id="sla-escalation" name="ÐÐ²Ñ‚Ð¾ÑÑÐºÐ°Ð»Ð°Ñ†Ð¸Ñ Ð¿Ð¾ SLA" isExecutable="true">

    <!-- === START === -->
    <bpmn:startEvent id="Start" name="SLA Ð½Ð°Ñ€ÑƒÑˆÐµÐ½Ð¸Ðµ">
      <bpmn:outgoing>Flow_ToLog</bpmn:outgoing>
    </bpmn:startEvent>

    <!-- Ð›Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ -->
    <bpmn:serviceTask id="Task_LogEscalation" name="Ð—Ð°Ñ„Ð¸ÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð½Ð°Ñ€ÑƒÑˆÐµÐ½Ð¸Ðµ SLA">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="log-activity" />
        <zeebe:ioMapping>
          <zeebe:input source="= entityId" target="entityId" />
          <zeebe:input source="= workspaceId" target="workspaceId" />
          <zeebe:input source="= &quot;sla:escalation&quot;" target="action" />
          <zeebe:input source="= &quot;ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ ÑÑÐºÐ°Ð»Ð°Ñ†Ð¸Ñ Ð¿Ð¾ SLA. Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ: &quot; + string(escalationLevel)" target="details" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_ToLog</bpmn:incoming>
      <bpmn:outgoing>Flow_ToLevelGw</bpmn:outgoing>
    </bpmn:serviceTask>

    <!-- ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ ÑƒÑ€Ð¾Ð²Ð½Ñ ÑÑÐºÐ°Ð»Ð°Ñ†Ð¸Ð¸ -->
    <bpmn:exclusiveGateway id="Gateway_Level" name="Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ ÑÑÐºÐ°Ð»Ð°Ñ†Ð¸Ð¸">
      <bpmn:incoming>Flow_ToLevelGw</bpmn:incoming>
      <bpmn:outgoing>Flow_Warning</bpmn:outgoing>
      <bpmn:outgoing>Flow_Breach</bpmn:outgoing>
      <bpmn:outgoing>Flow_CriticalBreach</bpmn:outgoing>
    </bpmn:exclusiveGateway>

    <!-- === Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ 1: ÐŸÑ€ÐµÐ´ÑƒÐ¿Ñ€ÐµÐ¶Ð´ÐµÐ½Ð¸Ðµ (80%) === -->
    <bpmn:serviceTask id="Task_NotifyAssignee" name="Ð£Ð²ÐµÐ´Ð¾Ð¼Ð¸Ñ‚ÑŒ Ð¸ÑÐ¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»Ñ">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="send-notification" />
        <zeebe:ioMapping>
          <zeebe:input source="= assigneeId" target="userId" />
          <zeebe:input source="= &quot;âš ï¸ SLA Ð¿Ñ€ÐµÐ´ÑƒÐ¿Ñ€ÐµÐ¶Ð´ÐµÐ½Ð¸Ðµ: Ð·Ð°ÑÐ²ÐºÐ° Ð±Ð»Ð¸Ð·ÐºÐ° Ðº Ð½Ð°Ñ€ÑƒÑˆÐµÐ½Ð¸ÑŽ ÑÑ€Ð¾ÐºÐ¾Ð²!&quot;" target="message" />
          <zeebe:input source="= entityId" target="entityId" />
          <zeebe:input source="= workspaceId" target="workspaceId" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_Warning</bpmn:incoming>
      <bpmn:outgoing>Flow_ToEndWarning</bpmn:outgoing>
    </bpmn:serviceTask>

    <bpmn:endEvent id="End_Warning" name="ÐŸÑ€ÐµÐ´ÑƒÐ¿Ñ€ÐµÐ¶Ð´ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¾">
      <bpmn:incoming>Flow_ToEndWarning</bpmn:incoming>
    </bpmn:endEvent>

    <!-- === Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ 2: ÐÐ°Ñ€ÑƒÑˆÐµÐ½Ð¸Ðµ (100%) === -->
    <bpmn:serviceTask id="Task_NotifySupervisor" name="Ð£Ð²ÐµÐ´Ð¾Ð¼Ð¸Ñ‚ÑŒ Ñ€ÑƒÐºÐ¾Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»Ñ">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="send-notification" />
        <zeebe:ioMapping>
          <zeebe:input source="= supervisorId" target="userId" />
          <zeebe:input source="= &quot;ðŸ”´ SLA Ð½Ð°Ñ€ÑƒÑˆÐµÐ½! Ð—Ð°ÑÐ²ÐºÐ° Ð½Ðµ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð½Ð° Ð² ÑÑ€Ð¾Ðº. Ð¢Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ Ð²Ð¼ÐµÑˆÐ°Ñ‚ÐµÐ»ÑŒÑÑ‚Ð²Ð¾.&quot;" target="message" />
          <zeebe:input source="= entityId" target="entityId" />
          <zeebe:input source="= workspaceId" target="workspaceId" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_Breach</bpmn:incoming>
      <bpmn:outgoing>Flow_ToNotifyAssigneeBreach</bpmn:outgoing>
    </bpmn:serviceTask>

    <bpmn:serviceTask id="Task_NotifyAssigneeBreach" name="Ð£Ð²ÐµÐ´Ð¾Ð¼Ð¸Ñ‚ÑŒ Ð¸ÑÐ¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»Ñ Ð¾ Ð½Ð°Ñ€ÑƒÑˆÐµÐ½Ð¸Ð¸">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="send-notification" />
        <zeebe:ioMapping>
          <zeebe:input source="= assigneeId" target="userId" />
          <zeebe:input source="= &quot;ðŸ”´ SLA Ð½Ð°Ñ€ÑƒÑˆÐµÐ½ Ð¿Ð¾ Ð²Ð°ÑˆÐµÐ¹ Ð·Ð°ÑÐ²ÐºÐµ! Ð ÑƒÐºÐ¾Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»Ñ‘Ð½.&quot;" target="message" />
          <zeebe:input source="= entityId" target="entityId" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_ToNotifyAssigneeBreach</bpmn:incoming>
      <bpmn:outgoing>Flow_ToEndBreach</bpmn:outgoing>
    </bpmn:serviceTask>

    <bpmn:endEvent id="End_Breach" name="Ð ÑƒÐºÐ¾Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»Ñ‘Ð½">
      <bpmn:incoming>Flow_ToEndBreach</bpmn:incoming>
    </bpmn:endEvent>

    <!-- === Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ 3: ÐšÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð½Ð°Ñ€ÑƒÑˆÐµÐ½Ð¸Ðµ (150%) === -->
    <bpmn:serviceTask id="Task_NotifyDirector" name="Ð£Ð²ÐµÐ´Ð¾Ð¼Ð¸Ñ‚ÑŒ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð° Ð¿Ð¾ ÑÐµÑ€Ð²Ð¸ÑÑƒ">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="send-notification" />
        <zeebe:ioMapping>
          <zeebe:input source="= directorId" target="userId" />
          <zeebe:input source="= &quot;ðŸš¨ ÐšÐ Ð˜Ð¢Ð˜Ð§Ð•Ð¡ÐšÐžÐ• Ð½Ð°Ñ€ÑƒÑˆÐµÐ½Ð¸Ðµ SLA! ÐŸÑ€ÐµÐ²Ñ‹ÑˆÐµÐ½Ð¸Ðµ ÑÑ€Ð¾ÐºÐ¾Ð² Ð±Ð¾Ð»ÐµÐµ 150%. Ð¢Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ Ð½ÐµÐ¼ÐµÐ´Ð»ÐµÐ½Ð½Ð¾Ðµ Ð²Ð¼ÐµÑˆÐ°Ñ‚ÐµÐ»ÑŒÑÑ‚Ð²Ð¾.&quot;" target="message" />
          <zeebe:input source="= entityId" target="entityId" />
          <zeebe:input source="= workspaceId" target="workspaceId" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_CriticalBreach</bpmn:incoming>
      <bpmn:outgoing>Flow_ToNotifySupervisorCritical</bpmn:outgoing>
    </bpmn:serviceTask>

    <bpmn:serviceTask id="Task_NotifySupervisorCritical" name="Ð£Ð²ÐµÐ´Ð¾Ð¼Ð¸Ñ‚ÑŒ Ñ€ÑƒÐºÐ¾Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»Ñ (ÐºÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ)">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="send-notification" />
        <zeebe:ioMapping>
          <zeebe:input source="= supervisorId" target="userId" />
          <zeebe:input source="= &quot;ðŸš¨ ÐšÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð½Ð°Ñ€ÑƒÑˆÐµÐ½Ð¸Ðµ SLA! Ð”Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»Ñ‘Ð½.&quot;" target="message" />
          <zeebe:input source="= entityId" target="entityId" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_ToNotifySupervisorCritical</bpmn:incoming>
      <bpmn:outgoing>Flow_ToEndCritical</bpmn:outgoing>
    </bpmn:serviceTask>

    <bpmn:endEvent id="End_Critical" name="Ð”Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»Ñ‘Ð½">
      <bpmn:incoming>Flow_ToEndCritical</bpmn:incoming>
    </bpmn:endEvent>

    <!-- === SEQUENCE FLOWS === -->
    <bpmn:sequenceFlow id="Flow_ToLog" sourceRef="Start" targetRef="Task_LogEscalation" />
    <bpmn:sequenceFlow id="Flow_ToLevelGw" sourceRef="Task_LogEscalation" targetRef="Gateway_Level" />

    <bpmn:sequenceFlow id="Flow_Warning" name="ÐŸÑ€ÐµÐ´ÑƒÐ¿Ñ€ÐµÐ¶Ð´ÐµÐ½Ð¸Ðµ (80%)" sourceRef="Gateway_Level" targetRef="Task_NotifyAssignee">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">= escalationLevel = "warning"</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_ToEndWarning" sourceRef="Task_NotifyAssignee" targetRef="End_Warning" />

    <bpmn:sequenceFlow id="Flow_Breach" name="ÐÐ°Ñ€ÑƒÑˆÐµÐ½Ð¸Ðµ (100%)" sourceRef="Gateway_Level" targetRef="Task_NotifySupervisor">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">= escalationLevel = "breach"</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_ToNotifyAssigneeBreach" sourceRef="Task_NotifySupervisor" targetRef="Task_NotifyAssigneeBreach" />
    <bpmn:sequenceFlow id="Flow_ToEndBreach" sourceRef="Task_NotifyAssigneeBreach" targetRef="End_Breach" />

    <bpmn:sequenceFlow id="Flow_CriticalBreach" name="ÐšÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ (150%)" sourceRef="Gateway_Level" targetRef="Task_NotifyDirector">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">= escalationLevel = "critical"</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_ToNotifySupervisorCritical" sourceRef="Task_NotifyDirector" targetRef="Task_NotifySupervisorCritical" />
    <bpmn:sequenceFlow id="Flow_ToEndCritical" sourceRef="Task_NotifySupervisorCritical" targetRef="End_Critical" />

  </bpmn:process>

  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="sla-escalation">
      <bpmndi:BPMNShape id="Start_di" bpmnElement="Start">
        <dc:Bounds x="152" y="222" width="36" height="36" />
      </bpmndi:BPMNShape>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
